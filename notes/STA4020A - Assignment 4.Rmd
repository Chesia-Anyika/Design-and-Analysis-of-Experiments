---
title: "STA4020A - Assignment 4"
author: "Chesia Anyika"
date: "2024-07-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**Task : Factorial and Split Plot Arrangements with Random and Fixed Effects**

```{r}
#libraries
library(tidyverse)
library(car)
```

# 1. Factorial Arrangement

## 1.1 Question

Consider a factorial experiment with the following factors and levels:

-   Factor A: Temperature (2 levels: Low and High) - Fixed Effect

-   Factor B: Humidity (2 levels: Low and High) - Fixed Effect

-   Factor C: Light Exposure (2 levels: Low and High) - Fixed Effect

a\. How many treatment combinations are there in this factorial experiment?

b\. Write down the full factorial design matrix including all treatment combinations.

c\. Assume you have conducted the experiment and collected data on the response variable.

-   Perform a factorial ANOVA to analyze the effects of Factors A, B, and C on the response.

-   Provide the ANOVA table summarizing the results.

-   Interpret the p-values and determine which factors (if any) have statistically significant effects on the response variable.

## 1.2 Number of Treatment combinations

In a factorial experiment, the number of treatment combinations is the product of the levels of all factors. Here we have:

-   Factor A: 2 levels (Low, High)

-   Factor B: 2 levels (Low, High)

-   Factor C: 2 levels (Low, High)

Thus the number of treatment combinations is:

$$
2 \times 2 \times 2 = 8
$$

## 1.3 Full-Factorial Design Matrix

The full factorial design matrix includes **all possible combinations of the levels of the factors.** Here is the design matrix for Factors A, B, and C:

| **Combination** | Factor A (Temperature) | Factor B (Humidity) | Factor C (Light Exposure) |
|-----------------|------------------------|---------------------|---------------------------|
| **1**           | Low                    | Low                 | Low                       |
| **2**           | Low                    | Low                 | High                      |
| **3**           | Low                    | High                | Low                       |
| **4**           | Low                    | High                | High                      |
| **5**           | High                   | Low                 | Low                       |
| **6**           | High                   | Low                 | High                      |
| **7**           | High                   | High                | Low                       |
| **8**           | High                   | High                | High                      |

I created this table in r as follows:

```{r}
# Create the data frame
data <- data.frame(
  A = factor(rep(c('Low', 'High'), each = 4)),
  B = factor(rep(c('Low', 'Low', 'High', 'High'), times = 2)),
  C = factor(rep(c('Low', 'High'), times = 4))
)

data
```

## 1.4 Factorial ANOVA Analysis

### 1.4.1 Simulation of Response Data

To perform Factorial ANOVA, we need to simulate response data $Y$ for each treatment combination. First, we define the effect sizes of each factor and all possibles interactions between factors. I defined the effect sizes such that:

**Factor A:** An increase temperature has a substantial effect on the response variable, by a factor of 4.

**Factor B:** An increase in humidity has a moderate effect on the response variable, by a factor of 2.5.

**Factor C** An increase in light exposure has a moderate effect on the response variable, by a factor of 3.

**Interaction AB:** There is a small interaction effect between temperature and Humidity, by a factor of 0.5.

**Interaction AC:** There is a moderate interaction effect between Temperature and Light Exposure, by a factor of 2.

**Interaction BC:** There is a small interaction effect between Humidity and Light Exposure, by a factor of 1.

**Interaction ABC:** There is a moderate interaction effect between the three factors, by a factor of 3

```{r}
# Define effect sizes per factor
effect_A <- c('Low' = 2, 'High' = 4) #Temperature
effect_B <- c('Low' = 1, 'High' = 2.5) #Humidity
effect_C <- c('Low' = 0, 'High' = 3) #Light Exposure  

# Define effect sizes per interaction
interaction_AB <- 0.5 #Temperature and Humidity
interaction_AC <- 2 #Temperature and Light Exposure
interaction_BC <- 1 #Humidity and Light Exposure
interaction_ABC <- 3 #Temperature, Humidity and Light Exposure

```

Next, we simulate the response data using these effect sizes and adding random noise, as follows:

```{r}
# Set seed for reproducability
set.seed(348)

# Simulate the response data
data$Y <- with(data,
  effect_A[A] +
  effect_B[B] +
  effect_C[C] +
  (interaction_AB * (A == 'High' & B == 'High')) +
  (interaction_AC * (A == 'High' & C == 'High')) +
  (interaction_BC * (B == 'High' & C == 'High')) +
  (interaction_ABC * (A == 'High' & B == 'High' & C == 'High')) +
  rnorm(length(A), mean = 23, sd = 100)  # Adding random noise
)

data
```

### 1.4.2 Interaction Plots

I plotted interaction plots for each factor pair, to obtain a visual understanding of how the pairs interact with each other. This will help understand the nature of the interactions -- either as synergistic, antagonistic or neutral -- which serves as a preliminary analysis prior to the ANOVA test.

**Interaction of Temperature and Humidity on Response Y**

```{r}
data$Y <- c(15, 29, 45, 32, 23, 12, 12, 34)
#Factors A & B
interaction.plot(x.factor = data$A,
                 trace.factor = data$B,
                 response = data$Y,
                 xlab = 'Temperature (A)',
                 ylab = 'Response Y',
                 trace.label = 'Humidity (B)',
                 main = 'Interaction plot of Factors A & B on Response Y')
```

**Interpretation**

When Temperature (A) is High, Response Y is higher for Low Humidity (B) compared to High Humidity. When Temperature (A) is Low, Response Y is higher for High Humidity (B) compared to Low Humidity.

The diverging lines indicate that the effect of Temperature on Response Y is different at different levels of Humidity, but they do not intersect. This still suggests an interaction effect, where **the impact of one factor depends on the level of the other**. The overall interaction can be described as **antagonistic**, implying the two factors work against each other in influencing Response Y.

**Interaction of Temperature and Light Exposure on Response Y**

```{r}
#Factors A & C
interaction.plot(x.factor = data$A,
                 trace.factor = data$C,
                 response = data$Y,
                 xlab = 'Temperature (A)',
                 ylab = 'Response Y',
                 trace.label = 'Light Exposure (C)',
                 main = 'Interaction plot of Factors A & C on Response Y')
```

**Interpretation**

When Temperature (A) is High, Response Y is higher for Low Light Exposure (C) compared to High Light Exposure. When Temperature (A) is Low, Response Y is higher for High Light Exposure (C) compared to Low Light Exposure.

The **interaction between A and C is significant** because the lines cross each other, indicating that the effect of Temperature (A) on Response Y depends on the level of Light Exposure (C), thus the two factors have a **synergistic** relationship.

**Interaction of Humidity and Light Exposure on Response Y**

```{r}
#Factors A & B
interaction.plot(x.factor = data$B,
                 trace.factor = data$C,
                 response = data$Y,
                 xlab = 'Humidity (B)',
                 ylab = 'Response Y',
                 trace.label = 'Light Exposure (C)',
                 main = 'Interaction plot of Factors B & C on Response Y')
```

**Interpretation**

When Humidity (B) is High, Response Y is higher for Low Light Exposure (C) compared to High Light Exposure. When Humidity (B) is Low, Response Y is higher for High Light Exposure (C) compared to Low Light Exposure.

The interaction between B and C is significant because the lines cross each other, indicating that the effect of Humidity (B) on Response Y depends on the level of Light Exposure (C), thus the two factors have a **synergistic** relationship.

### 1.4.2 ANOVA Table

The ANOVA table will include sources of variation (factors and their interactions), sum of squares (SS), degrees of freedom (df), mean squares (MS), F-values, and p-values.

```{r}
# Fit the full factorial model
model <- lm(Y ~ A * B * C, data = data)

#perform Anova
anova(model)

data
```

```{r}
# Install and load the car package for checking VIF
library(car)

# Fit the linear model
model <- lm(Y ~ A * B * C, data = data)

# Check VIF
vif(model, type = 'predictoe')

```
